    <main class="principal">
        <div class="contenedor">
            <section>
                <h2>üîß Diagn√≥stico del Sistema</h2>
                <p>Informaci√≥n sobre la importaci√≥n y estado de la base de datos.</p>

                <div id="infoGeneral">
                    <p class="cargando">Cargando informaci√≥n...</p>
                </div>
            </section>

            <section>
                <h3>üìÅ Archivos CSV</h3>
                <div id="archivosCSV">
                    <p class="cargando">Cargando...</p>
                </div>
            </section>

            <section>
                <h3>üìä Conteo de Registros</h3>
                <div id="conteosTablas">
                    <p class="cargando">Cargando...</p>
                </div>
            </section>

            <section>
                <h3>‚öôÔ∏è Acciones</h3>
                <button id="btnReimportar" class="btn btn-primario">üîÑ Forzar Reimportaci√≥n</button>
                <p style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--color-texto-secundario);">
                    Esto volver√° a importar todos los archivos CSV a la base de datos.
                </p>
                <div id="resultadoReimportacion" style="margin-top: 1rem;"></div>
            </section>

            <section>
                <h3>üì± Informaci√≥n de Red</h3>
                <div id="infoRed">
                    <p class="cargando">Cargando...</p>
                </div>
            </section>
        </div>
    </main>


    <!-- Contenedor de notificaciones toast -->
    <div id="notificaciones-component"></div>

    <!-- Footer generado din√°micamente -->
    <div id="footer-component"></div>

    <script>
        // Inicializaci√≥n inmediata para SPA
        (async () => {
            await Promise.all([
                cargarDiagnostico(),
                cargarInfoRed()
            ]);

            document.getElementById('btnReimportar').addEventListener('click', reimportar);
        })();

        async function cargarDiagnostico() {
            try {
                const diag = await api.obtenerDiagnostico();

                // Info general
                document.getElementById('infoGeneral').innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-numero">${diag.baseDatosExiste ? '‚úÖ' : '‚ùå'}</div>
                            <div class="stat-label">Base de Datos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-numero">${diag.ultimaImportacion ? '‚úÖ' : '‚è≥'}</div>
                            <div class="stat-label">Importaci√≥n</div>
                        </div>
                    </div>
                    ${diag.ultimaImportacion ? `
                        <p style="margin-top: 1rem;">
                            <strong>√öltima importaci√≥n:</strong> ${new Date(diag.ultimaImportacion).toLocaleString('es-ES')}
                        </p>
                    ` : ''}
                `;

                // Archivos CSV
                document.getElementById('archivosCSV').innerHTML = `
                    <table class="tabla">
                        <thead>
                            <tr>
                                <th>Archivo</th>
                                <th>Estado</th>
                                <th>Tama√±o</th>
                                <th>√öltima Modificaci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${diag.archivosCSV.map(a => `
                                <tr>
                                    <td>${escapeHtml(a.nombre)}</td>
                                    <td>${a.existe ? '‚úÖ Existe' : '‚ùå No encontrado'}</td>
                                    <td>${a.tamanoBytes ? formatearTamano(a.tamanoBytes) : '-'}</td>
                                    <td>${a.ultimaModificacion ? new Date(a.ultimaModificacion).toLocaleString('es-ES') : '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                // Conteos de tablas
                if (diag.conteosTablas && Object.keys(diag.conteosTablas).length > 0) {
                    document.getElementById('conteosTablas').innerHTML = `
                        <table class="tabla">
                            <thead>
                                <tr>
                                    <th>Tabla</th>
                                    <th>Registros</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(diag.conteosTablas).map(([tabla, count]) => `
                                    <tr>
                                        <td>${escapeHtml(tabla)}</td>
                                        <td>${formatearNumero(count)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                } else {
                    document.getElementById('conteosTablas').innerHTML = '<p>No hay datos de tablas disponibles.</p>';
                }

            } catch (error) {
                console.error('Error cargando diagn√≥stico:', error);
                document.getElementById('infoGeneral').innerHTML = htmlError('Error al cargar el diagn√≥stico.');
            }
        }

        async function cargarInfoRed() {
            try {
                const info = await api.obtenerInfoRed();
                document.getElementById('infoRed').innerHTML = `
                    <p><strong>Puerto:</strong> ${info.puerto}</p>
                    <p><strong>Direcciones IP locales:</strong></p>
                    <ul style="list-style: none; margin-top: 0.5rem;">
                        ${info.ips.map(ip => `
                            <li style="padding: 0.25rem 0;">
                                <code style="background: var(--color-fondo); padding: 0.25rem 0.5rem; border-radius: 4px;">
                                    http://${ip}:${info.puerto}
                                </code>
                            </li>
                        `).join('')}
                    </ul>
                `;
            } catch (error) {
                console.error('Error cargando info de red:', error);
            }
        }

        async function reimportar() {
            const btn = document.getElementById('btnReimportar');
            const resultado = document.getElementById('resultadoReimportacion');

            btn.disabled = true;
            btn.textContent = '‚è≥ Reimportando...';
            resultado.innerHTML = '<p class="cargando">Procesando archivos CSV...</p>';

            try {
                const resp = await api.reimportar();
                resultado.innerHTML = `
                    <div style="background: #dcfce7; padding: 1rem; border-radius: var(--radio-borde);">
                        <p>‚úÖ ${escapeHtml(resp.mensaje)}</p>
                        ${resp.advertencias && resp.advertencias.length > 0 ? `
                            <p style="margin-top: 0.5rem;"><strong>Advertencias:</strong></p>
                            <ul style="margin-top: 0.25rem; padding-left: 1.5rem;">
                                ${resp.advertencias.map(a => `<li>${escapeHtml(a)}</li>`).join('')}
                            </ul>
                        ` : ''}
                    </div>
                `;
                // Recargar diagn√≥stico
                await cargarDiagnostico();
            } catch (error) {
                console.error('Error en reimportaci√≥n:', error);
                resultado.innerHTML = `
                    <div style="background: #fee2e2; padding: 1rem; border-radius: var(--radio-borde);">
                        <p>‚ùå Error durante la reimportaci√≥n: ${escapeHtml(error.message)}</p>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîÑ Forzar Reimportaci√≥n';
            }
        }

        function formatearTamano(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
    </script>
