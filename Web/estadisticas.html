<main class="container">
    <main class="container">
        <section class="seccion">
            <h2>üìä Estad√≠sticas del Cat√°logo</h2>
            <p class="seccion-descripcion">Resumen general de su colecci√≥n de m√∫sica</p>

            <!-- Resumen Principal con Iconos -->
            <div class="resumen-grid" id="resumenPrincipal">
                <div class="resumen-card cargando">Cargando...</div>
            </div>
        </section>

        <!-- Desglose detallado -->
        <section class="seccion">
            <h2>üìã Desglose Detallado</h2>
            <div class="stats-grid" id="desglose">
                <div class="stat-card">
                    <div class="stat-label">Canciones en Cassettes</div>
                    <div class="stat-value" id="statTemasCassette">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Canciones en CDs</div>
                    <div class="stat-value" id="statTemasCd">--</div>
                </div>
            </div>
        </section>

        <!-- Top Int√©rpretes -->
        <section class="seccion">
            <h2>üèÜ Int√©rpretes con m√°s Canciones</h2>
            <div id="topInterpretes" class="lista-items">
                <p class="cargando">Cargando...</p>
            </div>
        </section>

        <!-- Marcas m√°s usadas -->
        <section class="seccion">
            <h2>üè∑Ô∏è Marcas m√°s Utilizadas</h2>
            <div id="topMarcas" class="lista-items">
                <p class="cargando">Cargando...</p>
            </div>
        </section>

        <!-- Duplicados -->
        <section class="seccion">
            <h2>üîÑ Canciones Duplicadas</h2>
            <p class="seccion-descripcion">Canciones que aparecen en m√∫ltiples Medios</p>
            <div id="statsDuplicados" class="stats-grid">
                <p class="cargando">Cargando...</p>
            </div>
            <div style="margin-top: 1rem;">
                <a href="duplicados.html" class="btn-primario"
                    style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.25rem; background: var(--color-primario); color: white; text-decoration: none; border-radius: var(--radio); font-weight: 500;">
                    üîç Ver todos los duplicados
                </a>
            </div>
        </section>
    </main>


    <!-- Contenedor de notificaciones toast -->
    <div id="notificaciones-component"></div>

    <!-- Footer generado din√°micamente -->
    <div id="footer-component"></div>

    <script>
        // Inicializaci√≥n inmediata para SPA
        (async () => {
            await Promise.all([
                cargarEstadisticas(),
                cargarDuplicados()
            ]);
        })();

        async function cargarDuplicados() {
            try {
                const resp = await fetch('/api/duplicados/estadisticas');
                const stats = await resp.json();

                document.getElementById('statsDuplicados').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-label">Grupos de duplicados</div>
                        <div class="stat-value">${stats.totalGrupos}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total instancias</div>
                        <div class="stat-value">${stats.totalCancionesDuplicadas}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Mixtos (CD+Cassette)</div>
                        <div class="stat-value">${stats.gruposMixtos}</div>
                    </div>
                `;
            } catch (error) {
                console.error('Error cargando duplicados:', error);
                document.getElementById('statsDuplicados').innerHTML = '<p class="error">Error al cargar</p>';
            }
        }

        async function cargarEstadisticas() {
            try {
                const resp = await fetch('/api/estadisticas');
                const stats = await resp.json();

                const totalTemas = (stats.totalTemasCassette || 0) + (stats.totalTemasCd || 0);

                // Resumen principal con iconos
                document.getElementById('resumenPrincipal').innerHTML = `
                    <div class="resumen-card">
                        <div class="resumen-icono">${ICONOS.iconoCassette}</div>
                        <div class="resumen-info">
                            <span class="resumen-numero">${formatearNumero(stats.totalCassettes || 0)}</span>
                            <span class="resumen-label">Cassettes</span>
                        </div>
                    </div>
                    <div class="resumen-card">
                        <div class="resumen-icono">${ICONOS.iconoCD}</div>
                        <div class="resumen-info">
                            <span class="resumen-numero">${formatearNumero(stats.totalCds || 0)}</span>
                            <span class="resumen-label">CDs</span>
                        </div>
                    </div>
                    <div class="resumen-card">
                        <div class="resumen-icono">${ICONOS.iconoMusica}</div>
                        <div class="resumen-info">
                            <span class="resumen-numero">${formatearNumero(totalTemas)}</span>
                            <span class="resumen-label">Canciones Totales</span>
                        </div>
                    </div>
                    <div class="resumen-card">
                        <div class="resumen-icono">${ICONOS.iconoInterprete}</div>
                        <div class="resumen-info">
                            <span class="resumen-numero">${formatearNumero(stats.totalInterpretes || 0)}</span>
                            <span class="resumen-label">Int√©rpretes</span>
                        </div>
                    </div>
                `;

                // Desglose
                document.getElementById('statTemasCassette').textContent = formatearNumero(stats.totalTemasCassette || 0);
                document.getElementById('statTemasCd').textContent = formatearNumero(stats.totalTemasCd || 0);

                // Top int√©rpretes
                const topInterpretes = document.getElementById('topInterpretes');
                if (stats.topInterpretes && stats.topInterpretes.length > 0) {
                    topInterpretes.innerHTML = stats.topInterpretes.map((i, idx) => `
                        <a href="interprete.html?nombre=${encodeURIComponent(i.nombre)}" class="item-card" data-spa-link>
                            <div style="width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; background: var(--color-primario); color: white; border-radius: var(--radio); font-size: 1.5rem; font-weight: 700;">
                                ${idx + 1}
                            </div>
                            <div class="item-contenido">
                                <div class="item-titulo">${escapeHtml(i.nombre)}</div>
                                <div class="item-info">${formatearNumero(i.totalTemas)} canciones en la colecci√≥n</div>
                            </div>
                        </a>
                    `).join('');
                } else {
                    topInterpretes.innerHTML = '<p class="cargando">No hay datos disponibles</p>';
                }

                // Top marcas
                const topMarcas = document.getElementById('topMarcas');
                if (stats.conteosPorMarca && stats.conteosPorMarca.length > 0) {
                    topMarcas.innerHTML = stats.conteosPorMarca.map((m, idx) => `
                        <div class="item-card" style="cursor: default;">
                            <div style="width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; background: var(--color-fondo); border: 2px solid var(--color-borde); border-radius: var(--radio); font-size: 1.25rem; font-weight: 700; color: var(--color-texto-secundario);">
                                ${idx + 1}
                            </div>
                            <div class="item-contenido">
                                <div class="item-titulo">${escapeHtml(m.marca || 'Sin marca')}</div>
                                <div class="item-info">${formatearNumero(m.total)} Medios</div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    topMarcas.innerHTML = '<p class="cargando">No hay datos disponibles</p>';
                }

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('topInterpretes').innerHTML = '<p class="error">Error al cargar las estad√≠sticas</p>';
                document.getElementById('topMarcas').innerHTML = '';
            }
        }
    </script>

</main>
